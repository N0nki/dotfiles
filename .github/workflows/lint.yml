name: Lint and Validate

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:
  shellcheck:
    name: ShellCheck
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Run ShellCheck
        uses: ludeeus/action-shellcheck@master
        with:
          severity: error
          ignore_paths: |
            common/nvim
            common/vim/dein
            common/fzf-git
            platforms/macOS/.zshrc
            platforms/macOS/.zprofile

  lua-check:
    name: Lua Syntax Check
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Install Luacheck
        run: |
          sudo apt-get update
          sudo apt-get install -y luarocks
          sudo luarocks install luacheck

      - name: Run Luacheck on Neovim config
        run: |
          luacheck common/nvim/lua --globals vim --no-unused-args || true
        continue-on-error: true

  yaml-check:
    name: YAML/JSON Validation
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Validate YAML files
        uses: ibiqlik/action-yamllint@v3
        with:
          config_file: .github/yamllint-config.yml
          file_or_dir: .
          strict: false
        continue-on-error: true

      - name: Validate JSON files
        run: |
          for file in $(find . -name "*.json" -not -path "*/node_modules/*" -not -path "*/.git/*"); do
            echo "Validating $file"
            jq empty "$file" || echo "Failed: $file"
          done
